# Chapter 02 컴퓨터의 구조와 성능 향상

## 01 컴퓨터의 기본 구성

### 하드웨어의 구성

- 필수 장치
    - 중앙처리장치(CPU)
    - 메인 메모리
- 보조 장치
    - 입력 장치
    - 출력 장치
    - 저장 장치
        - 제2저장장치(보보저장장치)
            - 하드 디스크
            - USB 메모리
- CPU와 메모리
    - CPU
        - 명령어를 해석하여 실행하는 장치
    - 메모리
        - 작업에 필요한 프로그램과 데이터를 저장하는 장소
        - 바이트 단위 분할, 분할 공간마다 주소를 가진다.
- 입출력장치
    - 입력 장치
        - 외부의 데이터를 컴퓨터에 입력하는 장치
        - 키보드, 마우스, 스캐너, 터치스크린
    - 출력 장치
        - 컴퓨터에서 처리한 결과를 사용자가 원하는 형태로 출력하는 장치
        - 프린터, 모니터, 스피커
- 저장 장치
    - 메모리는 전자의 이동으로 데이터를 처리하기 때문에 속도가 빠르다.
    - 하지만 하드디스크나 CD같은 저장 장치는 구동 장치가 있는 기계라서 속도가 느리다.
        - 그런데 왜 쓸까?
            - 저장 용량이 비해 가격이 저렴하다.
            - 전원 온,오프와 상관없이 데이터를 반영구적으로 저장하기 때문
- 메인보드
    - CPU와 메모리 등 다양한 부품을 연결하고 전원을 공급해주는 커다란 판
    - 메인보드에서 각 장치를 연결하여 데이터가 지나다니는 통로를 bus 라고 한다.

### 폰노이만 구조

- cpu, 메모리, 입출력장치, 저장장치가 **버스로 연결된 구조**를 말한다.
    - 폰노이만 구조가 등장하기 전의 컴퓨터는 전선을 연결하여 회로를 구성하는 하드와이어링 형태였기 때문에 다른 용도로 사용하려면 전선의 연결을 바꿔야 했다.
- 폰노이만 구조에서 가장 중요한 특징
    - **모든 프로그램은 메모리에 올라와야 실행할 수 있다.**
- clock 이란?
    - 컴퓨터에서 일정한 박자를 만들어내는 것
    - clock 에 의해 일정 간격으로 만들어지는 것을 purse 혹은 clock tick 이라 부른다.
    - clock 이 일정 간격으로 purse를 만들면 거기에 맞춰 컴퓨터 안의 모든 구성 부품들이 작업을 진행한다.
- cpu 성능을 나타낼 수 있는 단위는?
    - 헤르츠,Hz
    - 헤르츠는 **시간에 따라 변화가 일어날 때 사용하는 단위**다.
    - 컴퓨터에서 헤르츠 단위를 사용한다는 것은 **1초 동안 몇 번의 작업이 이루어져서 몇 번의 펄스(클록 틱)가 발생하였는가?** 를 의미한다.
        - 1초에 펄스가 1번 나타나면 1헤르츠, 1000번 나타나면 1킬로헤르츠가 된다.
- 시스템 버스?
    - 시스템 버스는 메모리와 주변 장치를 연결하는 버스다.
    - 메인보드의 동작 속도를 의미한다.
    - FSB(front side bus) 혹은 전면 버스라고 부른다.
- 소스코드를 기계어로 번역하는 방식
    - 컴파일 방식
        - 컴파일을 담당하는 프로그램을 컴파일러라고 부른다.
        - 컴파일러는 소스코드를 번역하여 기계어로 이루어진 실행파일을 만든다.
            - 컴퓨터는 이 실행파일을 실행함으로써 작업을 시작한다.
        - 컴파일 방식을 사용하여 실행 파일을 만들기 전에 오류를 찾고, 반복되는 작업을 하나로 합칠 수 있다.
    - 인터프리터 방식
        - 소스코드를 한 번에 한 문장 씩 번역하여 실행한다.
        - 실행 파일을 따로 만들지 않기 때문에 디버깅하기 어렵고, 반복되는 작업을 하나로 합치기도 어렵다.

## 02 CPU와 메모리

- CPU의 기본 구성
    - 산술 논리 연산 장치
        - ALU, Arithmetic and Logic Unit
        - 데이터의 덧셈, 뺄셈, 곱셈, 나눗셈과 같은 산술 연산과 AND, OR 같은 논리 연산을 수행한다.
    - 제어 장치
        - control unit
        - CPU에서 작업을 지시하는 부분
    - 레지스터
        - 작업에 필요한 데이터를 CPU 내부에 보관하는 곳
- CPU의 명령어 처리 과정?
    - 메모리 100번지에 있는 2와 메모리 120번지에 있는 3을 더하는 과정
        - 1. 제어 장치는 메모리 100번지에 있는 값 2를 레지스터 2로 옮기라는 명령을 내린다.
        - 2. 제어 장치는 메모리 120번에 있는 값 3을 레지스터 3으로 옮기라는 명령을 내린다.
        - 3. 레지스터 2와 3의 값을 ALU로 보내서 더하라는 명령을 내린다. 결과값 5는 레지스터5에 임시 보관된다.
        - 4. 레지스터 5의 값을 메모리 160번지(sum) 으로 옮기라는 명령을 내린다.

      → CPU는 필요한 데이터를 메모리에서 가져와 레지스터에 저장하고 산술놀리 연산장치를 이용하여 연산한 후, 그 결과를 다시 레지스터에 저장했다가 메모리로 옮긴다. (이 때 데이터 레지스터와 주소 레지스터 사용)

- 레지스터의 종류?
    - user visible regitser, 사용자 가시 레지스터
        - 데이터 레지스터
            - 메모리에서 가져온 데이터를 **임시로 보관할 때** 사용한다.
            - cpu에 있는 대부분의 레지스터가 데이터 레지스터이기 때문에 일반 레지스터 또는 범용 레지스터라고 부른다.
        - 주소 레지스터
            - 데이터 또는 명령어가 저장된 메모리의 주소는 주소 레지스터에 저장된다.
    - user-invinsible register, 사용자 불가시 레지스터, 특수 레지스터(사용자가 임의로 변경할 수 없다)
        - 프로그램 카운터
            - cpu는 다음에 어떤 명령어를 처리해야 할지 알아야 한다. 그래서 **프로그램 카운터는 다음에 실행할 명령어의 주소를 기억하고 있다가 제어장치에 알려준다.**
            - ‘명령어 포인터’라고도 한다.
        - 명령어 레지스터
            - **현재 실행 중인 명령어를 저장**한다.
            - 제저 장치는 명령어 레지스터에 있는 명령을 해석한 후 외부 장치에 적절한 제어 신호를 보낸다.
        - 메모리 주소 레지스터
            - 메모리에서 데이터를 가져오거나 반대로 메모리로 데이터를 보낼 때 **주소를 지정하는데 사용된다.**
            - 명령어를 처리하는 과정에서 필요한 메모리 주소를 이 레지스터에 넣으면 메모리 관리자가 인식하여 해당 메모리 위치의 데이터를 가져오거나 해당 메모리 위치에 데이터를 저장한다.
        - 메모리 버퍼 레지스터
            - 메모리에서 가져온 데이터나 메모리로 옮겨갈 **데이터를 임시로 저장**한다.
            - 메모리 버퍼 레지스터는 항상 메모리 주소 레지스터와 함께 동작한다.
- 시스템 버스는 언제 쓰나?
    - CPU와 메모리, 주변 장치 간에 **데이터를 주고 받을 때** 시스템 버스를 사용한다.
- 시스템 버스의 종류
    - 제어 버스
        - 다음에 어떤 작업을 할지 지시하는 제어 신호가 오고 간다.
        - 제어 버스의 신호는 CPU, 메모리, 주변장치와 양방향으로 오고 간다.
    - 주소 버스
        - 메모리의 데이터를 읽거나 쓸 때 **어느 위치에서 작업할 것인지를 알려주는 정보(주소)**가 오고 간다.
        - 주소 버스는 메모리 주소 레지스터와 연결되어 있으며 단방향이다.
            - CPU에서 메모리나 주변장치로 나가는 주소 정보는 있지만 주소 버스를 통해 CPU로 전달되는 정보는 없다.
    - 데이터 버스
        - 제어 버스가 다음에 어떤 작업을 할지 신호를 보내고 주소 버스가 위치 정보를 전달하면 데이터가 데이터 버스에 실려 목적지까지 이동한다.
        - 데이터버스는 메모리 버퍼 레지스터와 연결되어 있으며 양방향이다.
- CPU 비트의 의미
    - 버스의 대역폭은 한번에 전달할 수 있는 데이터의 최대 크기다.
- 메모리의 종류
    - 램(RAM, random access memory): 무작위로 데이터를 읽어도 저장된 위치와 상관없이 같은 속도로 데이터를 읽을 수 있다.
        - 휘발성
            - DRAM
                - dynamic ram
                - 저장된 0과 1의 데이터가 일정 시간이 지나면 사라지므로 일정 시간마다 다시 재생시켜야 한다.
                - 일반적으로 메인메모리에 사용
            - SRAM
                - static ram
                - 전력이 공급되는 동안에는 데이터를 보관할 수 있어 재생할 필요가 없다.
                - 속도가 빠르지만 가격이 비싸다.
                - 캐시같은 고속메모리에 사용
            - SDRAM
                - synchronous dynamic ram
                - DRAM 발전된 형태
                - 클록 틱이 발생할 때마다 데이터를 저장하는 동기 DRAM 이다.
        - 비휘발성: 전력이 끊겨도 내용이 남기 때문에 편리할 수 있지만 전력이 끊겨도 데이터를 보관하기 위해 **메모리 내부가 복잡하고 속도가 느리며 가격이 비싸다.**
            - 플래시 메모리
            - FRAM
            - PRAM
    - 롬(ROM, read only memory):전력이 끊겨도 메모리를 보관할 수 있지만 데이터를 한번 저장하면 바꿀 수 없다.
        - 마스크 롬
        - PROM
        - EPROM
- 메모리를 보호하기 위해, CPU가 작업하는 방식
    - 현재 진행 중인 작업의 메모리 시작 주소를 경계레지스터(bound register)에 저장한 후 작업한다.
    - 그리고 현재 진행 중인 작업이 차지하고 있는 메모리의 크기, 즉 마지막 주소까지의 차이를 한계레지스터(limit register)에 저장한다.

      → 사용자 작업이 진행되는 동안 이 두 레지스터의 주소 범위를 벗어나는지 하드웨어 측면에서 점검함으로써 메모리를 보호한다.

    - 두 레지스터의 주소 범위를 벗어나면 오류와 관련된 신호가 발생하고 이 신호를 **인터럽트**라 부른다.
- 부팅
    - 운영체제도 CPU에 의해 실행되는 프로그램이기 때문에 당연히 메모리에 올라와야 한다. 즉, 컴퓨터를 켰을 때 누군가가 운영체제를 메모리에 올려서 실행해야 한다.
    - 컴퓨터를 켰을 때 운영체제를 메모리에 올리는 과정을 부팅이라고 한다.
    - 부팅 과정
        - 사용자가 컴퓨터의 전원을 켜면 롬에 저장된 BIOS (basic input/ouput system) 가 실행된다.
            - bios 는 CPU, 메모리, 하드디스크, 키보드, 마우스와 같은 주요 하드웨어가 제대로 작동하는지 확인하고 이상이 있으면 ‘삐’ 소리와 함께 오류 메시지를 출력한다. (하드웨어 점검)
        - 하드웨어 점검이 완료되면 bios 의 맨마지막 작업은 하드디스크의 마스터 부트 레코드에 저장된 작은 프로그램은 메모리로 가져와 실행하는 것이다.
            - 마스터 부트 레코드는 하드디스크의 첫 번째 섹터를 가리키며 운영체제를 실행하기 위한 코드인 부트스트랩이 저장되어 있다.
            - 부트스트랩 코드(loader)는 하드디스크에 저장된 운영체제를 메모리로 가져와 실행하는 역할을 하는 작은 프로그램이다.

## 03 컴퓨터 성능 향상 기술

- 현대 컴퓨터 구조의 가장 큰 문제는?
    - CPU와 메모리, 주변장치의 작업 속도가 다르다는 것
        - 메인보드 내 메모리와 주변장치는 **시스템 버스**로 연결되어 있고,
        - CPU 내 레지스터, 산술논리 연산장치, 제어장치는 **CPU 내부 버스**로 연결되어 있다.
            - 따라서 메모리 속도는 시스템 버스와 같고, CPU 속도는 CPU 내부 속도와 같은데 CPU 내부 버스의 속도가 시스템 버스의 속도보다 빠르게 때문에 메모리를 비롯한 주변장치의 속도가 CPU 속도를 따라가지 못한다.
- 버퍼?
    - 일정량의 데이터를 모아서 옮겨 CPU와 보조기억장치 간의 속도 차이를 완화하는 장치, 임시 저장 공간
- 스풀?
    - CPU와 입출력장치가 **독립적으로 동작**하도록 고안된 소프트웨어적인 **버퍼**
    - ex) 프린터에 사용되는 스풀러
- 캐시?
    - 메모리와 cpu 간의 속도 차이를 완화하기 위해 메모리의 데이터를 미리 가져와 저장해 두는 임시 장소
    - cpu가 앞으로 사용할 것으로 예상되는 데이터를 미리 가져다 놓는다. (prefetch)
    - cpu 안에 있는 캐시는 cpu 내부 버스의 속도로 작동한다.
- 캐시 히트와 캐시 미스
    - 캐시히트는 캐시에서 원하는 데이터를 미리 찾았을 때 캐시 히트라고 하며 그 데이터를 바로 사용한다.
    - 캐시미스는 원하는 데이터가 캐시에 없을 때 메모리로 가서 데이터를 찾는 것.
- 캐시의 적중률을 높이는 방법은?
    - 캐시의 크기를 늘리는 것
    - 데이터를 가져오는 것
        - 관련된 이론: 지역성 이론(현재 위치에 가까운 데이터가 멀리 있는 데이터보다 사용될 확률이 더 높다)
- 캐시에 있는 데이터가 변경되면 메모리에 있는 원래 데이터를 변경해야한다. 캐시의 변경된 데이터를 메모리에 반영하는 방식은?
    - 즉시 쓰기
        - 캐시에 있는 데이터가 변경되는 이를 즉시 메모리에 반영하는 방식
        - 단점
            - 메모리와의 빈번한 데이터 전송으로 성능이 느려진다
        - 장점
            - 메모리의 최신 값이 항상 유지되기 때문에 급작스러운 정전에도 데이터를 잃어버리지 않는다.
    - 지연 쓰기
        - 캐시에 있는 데이터가 변경되면 그 내용을 모아서 주기적으로 반영하는 방식으로 copy back 이라고도 한다.
            - 장점
                - 메모리와의 데이터 전송 횟수가 줄어들어 시스템 성능을 향상시킬 수 있다.
            - 단점
                - 메모리와 캐시된 데이터 사이의 불일치 발생 가능성
- 캐시 레벨

  > 프로그램의 명령어는 크게 어떤 작업을 할지 나타내는 명령어 부분과 작업 대상인 데이터 부분으로 나눌 수 있다.
  >
    - 일반 캐시
        - 명령어와 데이터의 구분없이 모든 자료를 가져오는 것
    - 특수 캐시
        - 명령어와 데이터를 구분하여 가져오는 것
- 레벨 별 캐시 구조
    - 명령어 캐시는 명령어 레지스터와 연결되어 있다.
    - 데이터 캐시는 데이터 레지스터와 연결되어 있다.
    - 명령어 캐시나 데이터 캐시는 cpu 레지스터에 직접 연결되기 때문에 L1 캐시라 부르고, 일반 캐시는 메모리와 연결되기 때문에 L2 캐시라 부른다.
- 저장 장치의 계층 구조?
    - 속도가 빠르고 값이 비싼 저장 장치를 CPU 가까운 쪽에 두고, 값이 싸고 용량이 큰 저장 장치를 반대 쪽에 배치하여 적당한 가격으로 빠른 속도와 큰 용량을 동시에 얻는 방법
    - CPU-레지스터-캐시-메모리-저장장치
    - 중복되는 데이터의 일관성을 유지하는 것이 문제다.
- 폴링과 인터럽트
    - 폴링은 CPU가 직접 입출력 장치에서 데이터를 가져오거나 내보내는 방식
        - CPU가 명령어 해석과 실행이라는 본래 역할 외에 모든 입출력까지 관여해야 하므로 작업 효율이 떨어진다.
    - 인터럽트는 폴링의 문제점 해결
        - CPU작업과 저장장치의 데이터 이동을 독립적으로 운영함으로써 시스템의 효율을 높인다.
        - 즉, 데이터의 입출력이 이루어지는 동안 cpu가 다른 작업을 할 수 있다.
- 인터럽트 방식의 동작 과정

    1. CPU가 입출력 관리자에게 입출력 명령을 내보낸다.

    2. 입출력 관리자는 명령받은 데이터를 메모리에 가져다 놓거나 메모리에 있는 데이터를 저장장치로 옮긴다.

    3. 데이터 전송이 완료되면 입출력 관리자는 cpu에 완료 신호를 보낸다.

    - 입출력 관리자가 CPU에 보내는 완료 신호를 인터럽트라고 한다. **CPU는 입출력 관리자에게 작업 지시를 내리고 다른 일을 하다가 완료 신호를 받으면 하던 일을 중단하고 옮겨진 데이터를 처리한다.**
        - 이처럼 하던 작업을 중단하고 처리해야 하는 신호라는 의미에서 인터럽트라는 이름이 붙었다.
- 직접 메모리 접근?
    - direct memory access
    - 인터럽트 방식의 시스템을 구성하는 필요 요소다.
    - 메모리는 CPU만 접근 권한을 가진 작업 공간이라 입출력 관리자는 접근이 불가하다. 따라서 입출력 관리자에게 CPU의 허락없이 메모리에 접근할 수 있는 권한이 필요한데, 이것을 직접 메모리 접근이라고 한다.
- 메모리 맵 입출력?
    - 메모리를 나누어 사용하는 방법
    - 직접 메모리 방식을 사용하면 CPU가 사용하는 데이터와 입출력 장치가 사용하는 데이터가 섞여 메모리가 복잡해지는 문제가 있다.
    - 메모리에 CPU가 사용하는 메모리 공간과 직접 메모리 접근을 통해 들어오고 나가는 데이터를 위한 공간을 분리한다. 이렇게 **메모리의 일정 공간을 입출력에 할당하는 기법**을 메모리 맵 입출력이라고 한다.
    - 메모리 ⇒ 운영체제 영역 + **CPU 작업 영역 + 입출력 작업 영역**
- 사이클 훔치기
    - CPU와 직접 메모리 접근이 동시에 메모리에 접근하려 한다면?
        - cpu의 작업 속도가 빠르기 때문에 **메모리 사용 권한을 양보**하는데 직접 메모리 접근이 사이클(순서)를 훔쳐간 것이 되기 때문에 사이클 훔치기라고 부른다.

## 04 멀티 프로세싱

- 멀티 프로세서 시스템과 멀티 코어 시스템
    - 컴퓨터의 성능을 높이기 위해 프로세서를 여러 개 설치해서 사용하는 시스템을 멀티프로세서 시스템이라 부른다. 프로세서마다 레지스터, 캐시를 가지며 모든 프로세서가 시스템 버스를 통하여 메인메모리를 공유한다.
        - 장점은 많은 작업을 동시에 실행시킬 수 있다는 점
        - 단점은 프로세서가 하나만 있는 단일 프로세서 시스템을 멀티 프로세서 시스템으로 바꾸기 위해선 보드의 설계 변경을 비롯해 많은 변화가 필요하다.
            - 기존 시스템을 유지한 채 멀티 프로세싱 할 수 있게 하는 시스템이 멀티코어 시스템이다.
    - 멀티코어 시스템에서는 하나의 칩에 CPU의 핵심이 되는 코어를 여러 개 만들어 여러 작업을 동시에 처리 할 수 있다.
- 하나의 코어에서 여러 개의 명령어를 동시에 처리하는 것은?
    - 명령어 병렬 처리, instruction parallel processing
- CPU 멀티 스레드
    - 하나의 코어에 여러 개의 스레드를 이용하는 방식
        - 스레드란? CPU가 처리할 수 있는 작업의 단위

### Chapter 02 연습문제 정리

- CPU 기본 구성 요소
    - ALU(Arithmetic and Logic Unit)
        - 산술 연산
            - 덧셈, 뺄셈, 곱셈, 나눗셈
        - 논리 연산
            - and, or
    - Control Unit
        - CPU에서 수행할 내용 지시하는 부분
    - register
        - CPU 내 임시 저장 장치
- 사용자 불가시 레지스터
    - 프로그램 카운터
        - CPU는 다음에 처리할 명령어를 알아야 하는데 그 때 필요한 데이터를 임시로 저장하고 제어 유닛에 알려준다.
    - 명령어 레지스터
        - 현재 실행 중인 명령어 저장
        - 제어 유닛은 명령어 레지스터에 있는 명령어를 해석한 후에 외부 장치에 적절한 제어 신호를 보낸다.
    - 메모리 주소 레지스터
        - 메모리에서 데이터를 가져오거나, 메모리로 데이터를 보낼 때 데이터의 주소를 저장하는데 사용된다.
    - 메모리 버퍼 레지스터
        - 메모리에서 가져온 데이터나, 메모리로 옮겨갈 데이터를 임시로 저장한다.
        - 항상 메모리 주소 레지스터와 함께 동작한다.
- 시스템 버스를 구성하는 세 가지 버스의 특징
    - 제어 버스
        - cpu 내 제어 장치와 연결된 버스로 CPU가 메모리와 주변장치에 제어 신호를 보내기 위해 사용된다.
        - 메모리와 주변 장치에서도 작업이 완료되거나 오류가 발생하면 제어 신호를 보내기 위해 신호를 보낸다.
        - 양방향
    - 주소 버스
        - 메모리 주소 레지스터와 연결된 버스
        - 데이터를 읽거사 쓸 때 메모리나 주변장치에 위치 정보를 보내기 위해 사용
        - 단방향
    - 데이터 버스
        - 메모리 버퍼 레지스터와 연결된 버스
        - 데이터 이동이 양방향이다.
- 캐시
    - 메모리와 cpu 간의 속도 차이를 완화하기 위해 메모리의 데이터를 미리 가져와 저장해 두는 임시 장소
    - 캐시 히트
        - 캐시에 원하는 데이터를 찾았을 때
    - 캐시 미스
        - 원하는 데이터가 캐시에 없을 때
- 폴링과 인터럽트의 차이
    - 폴링은 cpu가 직접 입출력 장치에서 데이터를 가져오거나 내보내는 것
        - cpu가 입출력 장치의 상태를 주기적으로 검사하여 일정한 조건을 만족할 때 데이터를 처리한다.
            - 작업 효율 떨어진다.
    - 인터럽트는 폴링의 문제점을 해결하기 위해 등장했다.
        - cpu의 작업과 저장장치의 데이터 이동을 독립적으로 운영함으로써 시스템 효율을 높인 것
        - 즉 데이터의 입출력이 진행되는 동안 cpu가 다른 작업을 할 수 있다.
        - 입출력 관리자가 cpu에 보내는 완료 신호를 인터럽트라고 하는데 이 신호를 받으면 cpu는 하던 작업을 멈추고 관련된 데이터 처리를 해야 하는 신호라는 의미.
- 멀티 프로세싱
    - 여러 개의 프로세서가 서로 협력적으로 일을 처리하는 것
        - 여러 개의 프로세서가 작업을 병렬처리 하는 것

---

### 논의 내용

- 프로세스 vs 스레드
- 스크립트 언어 vs 컴파일 언어