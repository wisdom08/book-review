# 6장 전송 계층 : 신뢰할 수 있는 데이터 전송하기

- 키워드
    - 전송 계층, 연결형 통신, 비연결형 통신, TCP, UDP, 포트 번호,
- 질문 만들기
    - 전송 계층의 역할에 대해서 설명해주세요.
    - 전송 계층은 어떤 통신을 하나요?
    - TCP 헤더에 대해서 설명해주세요.
    - TCP 헤더의 구성요소 중 코드 비트란?
    - 3 way handshake 에 대해서 설명해주세요.
    - 4 way handshake 에 대해서 설명해주세요.
    - 3 way handsahake 이후 데이터 전송에 대해서 설명해주세요.
    - 포트 번호에 대해서 설명해주세요.
    - UDP 에 대해서 설명해주세요.
- 질문 답안
    - 전송 계층의 역할에 대해서 설명해주세요.
        - 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요하다.(**데이터를 제대로 전달하는 역할**)
        - 상위 계층들이 데이터 전달의 유효성이나 효율성을 신경쓰지 않도록 한다.
            - 어떻게?
                - **오류 점검**
                    - physical, data link, network 계층이 있으면 데이터를 목적지에 보낼 수 있는 역할을 하지만 데이터가 손상되거나 유실되더라도 1~3계층에서는 아무것도 해주지 않는다.
                    - tranport layer에서 오류 점검 기능을 통해 오류가 발생하면 데이터를 재전송하도록 요청한다.
                - **애플리케이션 식별**
                    - 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능도 있다.
    - 전송 계층은 어떤 통신을 하나요?
        - 연결형 통신

          데이터를 교환하기 전에 연결을 맺고 데이터를 교환하는 동안 계속 연결을 관리하는 프로토콜

            - 신뢰성/정확성이 중요할 때
                - 데이터를 목적지에 문제없이 전달하는 것
            - 상대방과 확인해 가면서 통신하는 방식
            - 프로토콜: TCP(transmission control protocol)
        - 비연결형 통신

          연결에 대한 초기화 과정이 없는 통신

            - 효율성이 중요할 때
                - 데이터를 빠르고 효율적으로 전달하는 것
            - 상대편을 확인하지 않고 일방적으로 전송하는 방식
            - 프로토콜: UDP(user datagram protocol)
    - TCP 헤더에 대해서 설명해주세요.
        - transport 계층에서 TCP로 전송할 때 붙이는 헤더
            - tcp헤더 + 데이터 → 세그먼트
        - 목적지까지 제대로 전송하기 위해 필요한 정보를 가지고 있다.
        - tcp 헤더 구성 중 코드 비트를 이용해서 connection 을 확립한다.
            - connection 이란?
                - TCP 통신에서 정보를 전달하기 위해 사용되는 **가상의 독점 통신로**로 연결을 확립하고 데이터를 전송한다.
    - TCP 헤더의 구성요소 중 코드 비트란?
        - 연결의 제어정보가 기록된다.
        - 코드비트는 6비트로 구성되고 URG, ACK, PSH, RST, SYN, FIN 각 비트별로 역할이 있다.
        - 초깃값은 0이고 비트가 활성화되면 1이 된다.
        - 연결을 확립하려면 syn, ack가 필요하고 연결을 종료하려면 fin, ack가 필요하다.
    - 3 way handshake 에 대해서 설명해주세요.

      **데이터를 보내기 전에 연결을 확립하기 위해 패킷 요청을 세 번 교환하는 것**

        - TCP헤더 구성요소 중 코드비트의 SYN 과 ACK을 사용하여 확립한다.
        - 컴퓨터1과 컴퓨터2가 connection 을 확립하는 과정
            1. 통신을 하려면 컴퓨터2에게 허가를 받아야 하므로, 먼저 컴퓨터1이 컴퓨터2에게 연결 확립 허가를 받기 위한 요청(SYN)을 보낸다.
                - SYN 1로 활성화
            2. 컴퓨터2는 컴퓨터1이 보낸 요청을 받은 후에 허가한다는 응답을 하기 위해 연결 확립 응답(ACK)를 보낸다. 동시에 컴퓨터2도 컴퓨터1에게 데이터 전송을 허가 받기 위해 연결 확립 요청(SYN)을 보낸다.
                1. ACK 1로 활성화
                2. SYN 1로 활성화
            3. 컴퓨터2의 요청을 받은 컴퓨터1은 컴퓨터2로 허가한다는 응답으로 연결 확립 응답(ACK)를 보낸다.
                1. ACK 1로 활성화
    - 4 way handshake 에 대해서 설명해주세요.

      **3 way handshake 과정으로 확립된 연결을 4단계 과정으로 끊는다.**

        - **컴**퓨터1과 컴퓨터2가 연결을 끊는 과정
            - 컴퓨터1과 컴퓨터2과 connection 을 종료하는 과정
                1. 컴퓨터1에서 컴퓨터2로 연결 종료 요청(FIN)을 보낸다.
                    1. FIN 1로 활성화
                2. 컴퓨터2에서 컴퓨터1로 연결 종료 응답(ACK)를 반환한다.
                    1. ACK 1로 활성화
                3. 또한 컴퓨터2에서도 컴퓨터1로 연결 종료 요청(FIN)을 보낸다.
                    1. FIN 1로 활성화
                4. 컴퓨터1에서 컴퓨터2로 연결 종료 응답(ACK)를 반환한다.
                    1. ACK 1로 활성화
    - 3 way handsahake 이후 데이터 전송에 대해서 설명해주세요.
        - TCP 헤더의 **sequence number 와 acknowledgement number**가 사용된다.
            - squence number
                - TCP는 데이터를 분할해서 보내는데 sequence number는 송신 측에서 수신측에 이 데이터가 몇 번 째 데이터인지 알려주는 역할을 한다.
                - **TCP 패킷의 순서 제어를 할 수 있게 된다.**
            - acknowledgement number
                - 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할
            - 위 두 개의 번호를 사용해서 데이터가 손상되거나 유실된 경우에 데이터를 재전송한다.
                - 이를 재전송 제어라고 한다.
        - 3 way handshake 과정에서 **window size** 서로 확인했기 때문에 window size 내에서 확인 응답을 받지 않고 세그먼트를 연속해서 보낸다.
            - 만약 데이터의 크키가 window size(버퍼 용량 크기)를 초과하면 overflow가 발생한다.
            - 여기서 버퍼란?
                - 수신한 세그먼트를 일시적으로 저장하는 장소
    - 포트 번호에 대해서 설명해주세요.
        - 어떤 애플리케이션인지 구분하는 역할을 한다.
        - TCP 헤더에 출발지 포트번호와 목적지 포트 번호가 있다.
        - 포트번호는 0~65535 번을 사용하고, 0~1023은 well-known ports 라고 한다.
            - ssh 22, smtp 25, dns 53, http 80, https 443
    - UDP 에 대해서 설명해주세요.
        - UDP는 효율성이 중요한 비연결형 통신이다.
        - UDP헤더 + 데이터 → 데이터그램
            - UDP헤더는 출발지 포트 번호, 도착지 포트 번호, 길이, 체크썸으로 구성된다.
        - UDP는 랜에서 불특정 다수에게 브로드캐스트로 데이터를 일괄 전송할 수 있다.
            - 브로드캐스트
                - 네트워크의 모든 컴퓨터와 장비에 같은 패킷을 일괄 전송하는 방식